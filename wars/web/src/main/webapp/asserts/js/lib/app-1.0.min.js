!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),e.exports=i(17)},function(e,t){!function(e){"use strict";e.youi=e.youi||{},e.extend(e.youi,{designerUtils:{buildItemTreeNodes:function(t,i,r){return function(t,i,r){var n={},s=[];return e(t).each(function(){var t=e.extend({},this);e.isFunction(i)&&i(t);var o=this.level?parseInt(this.level):r;if(o==r)s.push(t);else if(o>r){var a=n[o-1+""];a&&(a.children=a.children||[],a.children.push(t),a.expanded=!0)}n[this.level]=t}),s}(t,i,r||0)},parseItemsFromTreeNode:function(t,i){return function t(i,r,n){var s=[],r=r||0;var o=n?"."+n:"";e(">ul>li.treeNode"+o,i).each(function(){var i=e(this),o=e.extend({id:i.attr("id")},i.data(),{text:e.youi.treeUtils.getNodeText(i),level:r});delete o.group,s.push(o),s=s.concat(t(i,r+1,n))});return s}(t,0,i)},parseTreeNodeItemList:function(t,i){return function(t,i){var r=[];return e("li.treeNode"+(i?"."+i:""),t).each(function(){var t=e(this),i=e.extend({id:t.attr("id")},t.data(),{text:e.youi.treeUtils.getNodeText(t)});delete i.group,r.push(i)}),r}(t,i)},getFormFieldStrValue:function(t,i){if(!t||!i)return"";var r=t[i];return e.isArray(r)&&(0==r.length&&r.push(""),r=r[0]),r}},itemUtils:{insertItem:function(e,t,i){return[].concat(e.slice(0,i)).concat([t]).concat(e.slice(i,e.length))},removeItem:function(e,t){var i=[].concat(e.slice(0,t));return t!=e.length-1&&(i=i.concat(e.slice(t+1,e.length))),i},removeItemById:function(e,t){for(var i=[],r=0;r<e.length;r++)e[r].id!=t&&i.push(e[r]);return i},findItemIndexes:function(t,i){var r={};if(e.isArray(t)&&e.isArray(i))for(var n=0;n<t.length;n++)-1!=e.inArray(t[n].id,i)&&(r[t[n].id]=n);return r},findInsertIndex:function(t,i,r){var n;i?n=e.youi.itemUtils.findItemIndexes(t,[i])[i]+r+1:n=t.length;return n}},sheetEditor:{insertCol:function(e,t){this._proxySheetAreaAction("insertCol")},appendCol:function(e,t){this._proxySheetAreaAction("appendCol")},appendBlankCol:function(e,t){this._proxySheetAreaAction("appendBlankCol")},deleteCol:function(e,t){this._proxySheetAreaAction("deleteCol")},setTextIndent:function(e,t){this._proxySheetCommandAction("setTextIndent",e,t)},setAlign:function(e,t){this._proxySheetCommandAction("setAlign",e,t)},setFontSize:function(e,t){this._proxySheetCommandAction("setFontSize",e,t)},setBorder:function(e,t){this._proxySheetCommandAction("setBorder",e,t)},mergeArea:function(e,t){this._proxySheetCommandAction("mergeArea",e,t)},setSequence:function(e,t){this._proxySheetCommandAction("setSequence",e,t)},clearArea:function(t,i){e.youi.messageUtils.confirm("确认清除选区文本信息?",this._proxy("_proxySheetCommandAction","clearAreaText",t,i))},moveAreaText:function(e,t){var i=parseInt(t.value),r=this.contentElem.sheet("getSelectedArea");this.contentElem.sheet("moveArea",r,i)},_proxySheetAreaAction:function(e){var t=this.contentElem.sheet("getSelectedArea");this.contentElem.sheet(e,t)},_proxySheetCommandAction:function(e,t,i){var r=this.contentElem.sheet("getSelectedArea");if("mergeCellText"==i.value){var n=this.contentElem.sheet("getSelectedTexts");this.contentElem.sheet("setCellText",{rowIndex:r.startRow,colIndex:r.startCol,text:n.join("")})}this.contentElem.sheet(e,t,i,r)}},abstractDesigner:e.extend({},e.youi.command,{options:{useModelTree:!0},_initContent:function(t){this.UUID=0,this.contentElem=this.element.find(">."+this.widgetName+"-content:first").addClass("auto-height"),e.isFunction(t)&&t(this.contentElem)},_initRefWidget:function(){this._initSubPages(),this._initModelTree()},_initModelTree:function(){var t,i;t=this.options.useModelTree,i=this.options.refs,t&&e.isArray(i)&&i.length>0&&(this.modelTreeElem=e("#"+this.options.refs[0]),this.modelTreeElem.hasClass("youi-tree")?(this._bindTreeMenuAction(),this.element.parents(".youi-treePage").length||(window[this.options.refs[0]+"_select"]=this._proxy("_treeNodeSelect"))):this.modelTreeElem=null)},_treeNodeSelect:function(e){},_bindTreeMenuAction:function(){var t=[],i=this.modelTreeElem.data("xmenu");i&&e("#"+i).find("li.youi-xmenuitem[data-name]").each(function(){t.push(e(this).data("name"))});for(var r=0;r<t.length;r++){var n=this.options.refs[0]+"_xmenu_"+t[r];if(!e.isFunction(window[n])&&(window[n]=this._proxy(t[r]),0==t[r].indexOf("open"))){var s=t[r].substring(4,5).toLocaleLowerCase()+t[r].substring(5);this.subPages[s]&&!e.isFunction(this[t[r]])&&(this[t[r]]=this._proxy("openSubPageByMenu",s))}}},_refreshModelTree:function(t,i){if(this.modelTreeElem&&this.modelTreeElem.length){var r=this.modelTreeElem.find("ul:first").empty(),n=[];e(t).each(function(){var t={};if(i)for(var r in i)this[r]&&i[r]&&(t[i[r]]=this[r]);n.push(e.youi.treeUtils.treeNodeHtml(this.id,this.text,t,{children:this.children,group:this.group}))}),r.html(n.join(""))}},_treeNodeMoveDown:function(){var e=this.modelTreeElem.tree("getSelected"),t=e.next("li.treeNode");if(t.length)return t.after(e),e},_treeNodeMoveUp:function(){var e=this.modelTreeElem.tree("getSelected"),t=e.prev("li.treeNode");if(t.length)return t.before(e),e},_treeNodeMoveLeft:function(){var e,t=this.modelTreeElem.tree("getSelected"),i=t.parents("li.treeNode:first");i.length&&(i.after(t),(e=i)&&(0==e.find(">ul>li").length?e.removeClass("expandable"):e.addClass("expandable")))},_treeNodeMoveRight:function(){var t=this.modelTreeElem.tree("getSelected"),i=t.prev("li.treeNode");if(i.length){this.modelTreeElem.tree("addNode",i,"temp_","temp_"),i.find(">ul>li:last").remove();var r=i.find(">ul");0==r.length&&(r=e("<ul></ul>").appendTo(i)),r.append(t)}},_updateTreeNode:function(t,i,r,n,s){e.isArray(t)&&(t=t[0]);var o=this.modelTreeElem.find(".treeNode."+i+"[data-id="+t+"]");for(var a in r&&o.find(">span>a").text(r),s&&this._setTreeNodeToolTips(o,s),n=n||{}){var l=n[a];if(e.youi.stringUtils.notEmpty(l)){var d="data-"+e.youi.stringUtils.convertDataProperty(a,"-");o.attr(d,l).data(a,l)}}return o},_removeTreeNode:function(e){this.modelTreeElem.tree("removeNode",e)},_setTreeNodeToolTips:function(e,t){t=t||"";var i=e.find(">.tree-span>span.tree-node-hint");0!=i.length?i.text(t):e.find(">.tree-span").append("<span class='tree-node-hint'>"+t+"</span>")},_buildChildItem:function(e){var t={};return e&&e.id&&(t.parentId=e.id,t.parentText=e.text),t},_addItemTreeNode:function(e,t,i,r){var n,s=e.parentId,o=0,a=["item",t];return s&&(o=(n=this.modelTreeElem.find(".treeNode."+t+"[data-id="+s+"]")).find(".treeNode."+t).length),n&&n.length||(n=this.modelTreeElem.find(".treeNode."+t+"-parent:first")),e.id=this._genUUID(r||"M",this.modelTreeElem),i&&(a=a.concat(i)),this.modelTreeElem.tree("addNode",n,e.id,e.text,{id:e.id,"mapped-id":e.mappedId,expression:e.expression},{tooltips:e.mappedId,group:a.join(" ")}),o},_addTreeNode:function(e,t,i,r,n,s){var o=[e.attr("id")];this.modelTreeElem.tree("visitParents",e,function(e){o.push(e.getAttribute("id"))}),o.reverse(),this.modelTreeElem.tree("openPath",o.join("/")+"/").tree("addNode",e,s||this._genUUID(t,this.modelTreeElem),i,r,n||{})},_initSubPages:function(){if(this.subPages=[],e.isArray(this.options.refs))for(var t=0;t<this.options.refs.length;t++){var i=this.options.refs[t].split("_subpage_");if(2==i.length){var r=i[1];this.subPages[r]={subPageId:this.options.refs[t]};var n="P_"+this.options.refs[t]+"_form_afterSubmit";e.isFunction(window[n])||(window[n]=this._proxy("_afterSubmitSubPage",{name:r}))}}},openSubPageByMenu:function(t,i,r){var n=e(t),s=n.parents(".treeNode:first"),o=s.data("id")?e.youi.treeUtils.getNodeText(s):"",a=e.extend({commandValue:i.value,text:e.youi.treeUtils.getNodeText(n),parentText:o,id:n.attr("id")},n.data()),l={record:a};this._openSubPage(r,l,a)},_openSubPage:function(t,i,r){if(this.subPages&&this.subPages[t]){var n=this.subPages[t].subPageId;e("#"+n).unbind("initPageData").bind("initPageData",this._proxy("_initPageData",i,t)).subpage("open",{},{},e.extend({},r,{subPageId:n}))}},_initPageData:function(t,i,r,n){if(r&&i&&e.isFunction(window[i.callback])){var s=null,o="_"+n+"FormRecord";e.isFunction(this[o])&&(s=this[o](r.record)),s=e.extend({},i.record,s||r.record);var a="P_"+this.subPages[n].subPageId+"_form";e("#"+a).form("reset").form("fillRecord",s),window[i.callback](s)}},_afterSubmitSubPage:function(t,i){var r=i.name;if(this.subPages&&this.subPages[r]){var n=this.subPages[r].subPageId;e("#"+n).dialog("close");var s="_"+r+"AfterFormSubmit";e.isFunction(this[s])&&this[s](t.record)}},_destroyDesigner:function(){this.model=null,this.contentElem=null,this.modelTreeElem=null,this.subPages=[]},_genUUID:function(e,t){e=e||"",t=t||this.contentElem||this.element;var i=e+this.UUID++;return t.find("#"+i).length?this._genUUID(e,t):i},setDirty:function(){this.element.attr("data-dirty","1")},isDirty:function(){return"1"===this.element.attr("data-dirty")},removeDirty:function(){this.element.removeAttr("data-dirty")},_resizeHeight:function(){var t=this.element.innerHeight();if(t>0){var i=0;this.element.find(">.fixed-height").each(function(){i+=e(this).outerHeight()}),this.element.find(">.auto-height").height(t-i-10)}}})})}(jQuery)},function(e,t){var i;(i=jQuery).widget("youi.treePage",i.youi.abstractWidget,i.extend({},{options:{bindResize:!0},_initWidget:function(){this.contentElem=this.element.find(">.treePage-content:first").addClass("auto-height"),this.treeElem=i("#"+this.options.refs[0]),this.element.attr("data-hash",!0),window[this.options.refs[0]+"_select"]=this._proxy("_treeNodeSelect"),window[this.options.refs[0]+"_afterLoad"]=this._proxy("_treeAfterLoad"),this.element.trigger("pagehash",{init:!0,startPage:this._parsePageUrl()||this.options.startPage}),this._bindWidgetCommand(),this.options.contentWidget&&this.contentElem[this.options.contentWidget](this.options)},_parsePageUrl:function(){var e=window.location.hash,t=e.indexOf("###nodeId:");return t>-1?e.substring(t+"###nodeId:".length):null},_treeAfterLoad:function(e){this._callGloablFunc("afterLoad");var t=this.treeElem.data("openPath");t&&window.setTimeout(this._proxy("_openPath",t),200),this.treeElem.find("li.root").removeClass("expanded").removeClass("expandable")},loadTreeNodes:function(e){var t=[];if(e&&(i(e).each(function(){t.push(i.youi.treeUtils.treeNodeHtml(this.id,this.text,{group:this.group},this))}),this.treeElem.find(">ul").html(t.join("")),this.options.sourceStyle&&-1==window.location.hash.indexOf("treepage###"))){var r=this.treeElem.find(".treeNode."+this.options.sourceStyle+":first").attr("id");window.setTimeout(this._proxy("_openPath",r),100)}},_openPath:function(e){this.treeElem.tree("openPath",e)},_treeNodeSelect:function(e){var t=e.attr("id"),i=[];try{this.treeElem.tree("visitParents",e,function(e){i.push(e.getAttribute("id"))}),(i=i.reverse()).push(t),this.element.trigger("setpagehash",{hash:i.join("/"),partHash:"treePage"})}catch(e){console.log(e)}this._callGloablFunc("select",e)},_initAction:function(){this._on({pagehash:function(e,t){var i=window.location.hash;t.init&&-1==i.indexOf("?")&&(window.location.hash=window.location.hash+"?treepage");var r=i.indexOf("###nodeId:");if(r>-1){var n=i.substring(r+"###nodeId:".length),s=n.split("/"),o=s[s.length-1];this.treeElem.find("li.treeNode#"+o),t.init?(this.treeElem.attr("data-open-path",n),this.element.trigger("resize")):n&&this.treeElem.tree("openPath",n)}return!1},setpagehash:function(e,t){var i=window.location.hash;if(t.hash&&t.partHash){var r=i.indexOf("###nodeId:");window.location.hash=-1!=r?i.substring(0,r)+"###nodeId:"+t.hash:i+"###nodeId:"+t.hash}return!1}})},_afterLoadPage:function(){},loadHtml:function(e){this.contentElem.html(e)},loadPage:function(e){i.youi.pageUtils.loadPage(this.contentElem,e,this._proxy("_afterLoadPage"))},_resize:function(){this._resizePageHeight()}}))},function(e,t){
/*!
 * youi JavaScript Library v3.0.0
 *
 *
 * Copyright 2016-2020, zhyi_12
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: 2016-1-4
 */
!function(e){function t(e){for(var t="",i=e;i>0;){var r=i%26;0==r&&(r=26),t=String.fromCharCode(r+64)+t,i=(i-r)/26}return t}function i(t){var i=[],r=t.text;for(var n in delete t.text,delete t.rowIndex,delete t.colIndex,i.push("<td "),t.datas)e.youi.stringUtils.notEmpty(t.datas[n])&&i.push("data-"+e.youi.stringUtils.convertDataProperty(n)+'="'+t.datas[n]+'" ');for(var n in t)"string"==typeof t[n]&&e.youi.stringUtils.notEmpty(t[n])&&i.push(n+'="'+t[n]+'" ');return i.push(">"),i.push(r||""),i.push("</td>"),i.join("")}function r(t){var i={id:t.attr("id"),text:t.text()||t.find("input:first").val(),class:t[0].className,rowspan:t.attr("rowspan"),colspan:t.attr("colspan"),datas:{mergeId:t.attr("data-merge-id"),expression:t.attr("data-expression")}},r={textIndent:"0px",fontSize:"14px",color:"rgb(51, 51, 51)",backgroundColor:"rgba(0, 0, 0, 0)",textAlign:"start",borderTopColor:"rgb(192, 192, 192)",borderRightColor:"rgb(192, 192, 192)",borderBottomColor:"rgb(192, 192, 192)",borderLeftColor:"rgb(192, 192, 192)"};t.removeClass("selected");var n=[];for(var s in r){var o=t.css(s);o&&r[s]!=o&&n.push(e.youi.stringUtils.convertDataProperty(s)+":"+o)}return n.length&&(i.style=n.join(";")+";"),t[0].className=i.class,i}function n(e,t){return e-t}e.widget("youi.sheet",e.youi.abstractWidget,e.extend({},{options:{bindResize:!0,width:800,editable:!1,mode:"horizontal",expression:"records[{recordName}][{recordIndex}].items[{itemIndex}].values[valueIndex]"},_initWidget:function(){this._mouseInit(),this.tableDom=this.element.find("table")[0],this.element.addClass("page-editor");var t=this.options.xmenu||this.options.id+"_xmenu",i=e("#"+t);i.length&&(this.pasteHelper=e('<div class="paste-helper" style="position:absolute;z-index: -1;left:0px;top:0px;" contenteditable="true"></div>').insertBefore(this.element),this.options.xmenu=t,new ClipboardJS(i.find(".xmenu-item[data-name=copy]")[0],{text:this._proxy("_findCopyAreaText")}),this.pasteHelper.bind("paste",this._proxy("_paste",this.options.customPaste)),this.pasteHelper.bind("keypress",this._proxy("_copy")))},_copy:function(t){t.ctrlKey&&3==t.keyCode&&e("#"+this.options.xmenu).find(".xmenu-item[data-name=copy]").trigger("click")},_findCopyAreaText:function(e){return this.getSelectedTexts(!0).join("")},_paste:function(t,i){if(t&&t.originalEvent){e(t.currentTarget).empty();var r=t.originalEvent.clipboardData;r||(r=window.clipboardData);var n=r.getData("text");if(n){var s=n.replace(/\n|\r/g,"\t").split("\t");this.element.find(".cell.selected").each(function(t){var r=e(this);null==e.trim(s[t])||r.hasClass("readonly")||(e.isFunction(i)?i(r,s[t]):r.text(s[t]))})}}},_mouseStart:function(t){var i=e(t.target);i.hasClass("cell")?(this._clearSelectedArea(),this.dragElem=i,this.helper=this._createHelper()):i.is("span.cell-text")||i.hasClass("col-resize-handler")&&(this.dragElem=i.parent(),this.colResizeHelper=this._getResizeHelper().css({left:this.dragElem[0].offsetLeft+this.element.find(".pubHeader").outerWidth(),width:this.dragElem.outerWidth(),height:this.element.innerHeight()-10}).show())},_mouseDrag:function(t){var i=e(t.target);if(this.colResizeHelper){var r=this._computeHelperPos(t);this.colResizeHelper.width(r.width-25)}else if(this.dragElem){r=this._computeHelperPos(t);this.helper.css(r),i.hasClass("cell")&&(this.dropElem=i);var n=this.helper[0].offsetTop+this.helper.height()-this.element.height(),s=this.helper[0].offsetLeft+this.helper.width()-this.element.width();n>0&&this.element.scrollTop()<n&&n<e(this.tableDom).height()-this.element.height()+50&&this.element.scrollTop(n),s>0&&this.element.scrollLeft()<s&&this.element.scrollLeft(s)}},_mouseStop:function(e){this._colResizeStop(),this.dragElem&&this.dropElem&&this._showSelectedArea(this.dragElem,this.dropElem),this.helper&&this.helper.hide(),this.dropElem=null,this.dragElem=null},_colResizeStop:function(){this.colResizeHelper&&(this.dragElem.width(Math.max(this.colResizeHelper.width()+10,20)),this.colResizeHelper.hide(),this.colResizeHelper=null)},_getResizeHelper:function(t){var i=(t||"col")+"-resize-helper",r=this.element.find(">."+i);return r.length||(r=e('<div class="'+i+'">').appendTo(this.element)),r},_showSelectedArea:function(e,t){var i=this._cellAreaIter(e,t);this._selectCellsByArea(i),this.pasteHelper&&this.pasteHelper.focus()},_selectCellsByArea:function(t){var i=[];this._cellIter(t,function(t){var r="";t.hasClass("merged-cell")?r=t.attr("id"):t.hasClass("hide")&&(r=t.attr("data-merge-id")),r&&-1===e.inArray(r,i)&&i.push(r)}),i.length?this._showSelectedAreaWithMerge(t,i):this._addAreaSytle(t,"selected")},_showSelectedAreaWithMerge:function(e,t){if(t.length>0){for(var i=e.startRow,r=e.endRow,n=e.startCol,s=e.endCol,o=0;o<t.length;o++){var a=this.element.find("#"+t[o]);if(0!==a.length){var l=a.parent().prevAll().length,d=a.prevAll().length,h=parseInt(a.attr("rowspan")),c=parseInt(a.attr("colspan"));i=Math.min(i,l),r=Math.max(r,l+h-1),n=Math.min(n,d),s=Math.max(s,d+c-1)}}var u={startRow:i,endRow:r,rows:r-i+1,startCol:n,endCol:s,cols:s-n+1};this._needReSelectedArea(e,i,r,n,s)?this._selectCellsByArea(u):this._addAreaSytle(u,"selected")}},_needReSelectedArea:function(e,t,i,r,n){return e.startRow!==t||e.endRow!==i||e.startCol!==r||e.endCol!==n},getSelectedTexts:function(t){var i=[];return this.tableDom||(this.tableDom=this.element.find("table")[0]),this.tableDom&&e(".cell.selected",this.tableDom).each(function(){var r=e(this),n=e.trim(r.text());if(r.hasClass("dropdown")){var s=r.find("span:first");n=s.length?e.trim(s.text()):""}t&&(r.next(".selected").length?n+="\t":n+="\n"),i.push(n)}),i},_getSelectedAreaTexts:function(){var t=[[]];return this.tableDom||(this.tableDom=this.element.find("table")[0]),this.tableDom&&e(".cell.selected",this.tableDom).each(function(){var i=e(this),r=e.trim(i.text());if(i.hasClass("dropdown")){var n=i.find("span:first");r=n.length?e.trim(n.text()):""}t[t.length-1].push(r),i.next(".selected").length||t.push([])}),t},getSelectedRowTexts:function(){return this.getSelectedTexts(!0).join("").replace(/\t/g,"/").split("\n")},getSelectedColTexts:function(e){e=e||1;for(var t=this._getSelectedAreaTexts(),i=[],r=Math.min(t.length-1,e),n=0;n<t[0].length;n++){for(var s=[],o=0;o<r;o++)s.push(t[o][n]);i.push(s.join(""))}return i},_getAreaRecords:function(e){return this._cellAreaRecordsIter(e)},moveArea:function(t,i){for(var r=t.startRow;r<=t.endRow;r++){var n=e(this.tableDom.rows[r+1].cells[t.startCol-1]),s=e(this.tableDom.rows[r+1].cells[t.endCol+1]);i>0?n.before(s):i<0&&s.after(n)}},_cellAreaRecordsIter:function(t,i){var n=[];return this._cellIter(t,function(t,s,o,a){var l=e(t),d=e.extend({rowIndex:s,colIndex:o},r(l));e.isFunction(i)&&i(d,l,s,o,a),n.push(d)}),n},_cellAreaIter:function(t,i,r){var n=t.parent().prevAll().length,s=i.parent().prevAll().length,o=t.prevAll().length,a=i.prevAll().length,l={startRow:Math.min(n,s),endRow:Math.max(n,s),startCol:Math.min(o,a),endCol:Math.max(o,a),rows:Math.abs(n-s)+1,cols:Math.abs(o-a)+1};return e.isFunction(r)&&this._cellIter(l,r),l},_cellIter:function(t,i){if(this.tableDom||(this.tableDom=this.element.find("table")[0]),this.tableDom&&e.isFunction(i))for(var r=0;r<t.rows;r++)for(var n=0;n<t.cols;n++){var s=r+t.startRow+1,o=n+t.startCol;i(e(this.tableDom.rows[s].cells[o]),s,o,t)}},cellIter:function(e,t){this._cellIter(e,t)},_clearSelectedArea:function(){this.element.find(".cell.selected").removeClass("selected")},_createHelper:function(t){var i=this.element.find(".select-helper");return 0==i.length?i=e('<div class="select-helper"></div>').appendTo(this.element):i.show(),i},_computeHelperPos:function(e){var t=e.pageX,i=e.pageY,r=this.options.container?this.options.container.offset():this.element.offset(),n=this.dragElem.offset(),s=n.left>t?5:0,o=n.left>t?0:5,a=this.element.scrollLeft(),l=this.element.scrollTop();return{left:Math.min(n.left,t)-r.left+s+a,top:Math.min(n.top,i)-r.top+l,width:Math.abs(t-n.left)-o,height:Math.abs(i-n.top)}},_initAction:function(){this._on({click:function(){this._closeEditor()},"mouseout .cell .editor:not(.select-value)":function(t){var i=e(t.target).parents(".cell:first"),r=i.data("oldValue");this._closeEditor();var n=i.data("value")||i.text();(!r&&n||r!=n)&&(i.data("oldValue",n),i.trigger("cellChange",{oldValue:r,value:n}))},"click .cell .editor":function(){return!1},"click .cell .editor.select-value":function(t){return e(t.currentTarget).parents(".cell:first").trigger("click"),!1},"cellValue .cell":function(t,i){var r=e(t.currentTarget);(i.value||"0"==i.value)&&(i.text?r.hasClass("fieldSelect")?r.data("value",i.value).attr("data-value",i.value).empty().append('<span data-value="'+i.value+'" class="editor select-value">'+i.text+"</span>"):(r.data("value",i.value),r.text(i.text)):r.text(i.value))},"click .cell .option-item":function(t){var i=e(t.currentTarget),r=i.parents(".cell:first"),n=r.data("value"),s=i.data("value");if(r.data("value",s).attr("data-value",s).find("span.editor:first").text(i.text()),r.removeClass("open").removeClass("cell-editing"),r.is('[data-editor="fieldRadioGroup"]')){if(!0!==this.options.editable)return!1;i.addClass("icon-ok-circle").removeClass("icon-circle-blank"),r.find(".option-item").not(i).removeClass("icon-ok-circle").addClass("icon-circle-blank")}return(!n&&s||n!=s)&&r.trigger("cellChange",{oldValue:n,value:s}),!1},"click .cell":function(t){this._hiddenContextMenu();var i=e(t.target);return this._clickCell(i),!0!==this.options.editable||i.hasClass("readonly")?i.hasClass("readonly")&&this._closeEditor():this._openEditor(i),!1},"click .rowHeader":function(t){this._selectedRow(e(t.currentTarget).parent().prevAll().length+1)},"click .colHeader":function(t){this._selectedCol(e(t.currentTarget).prevAll().length)},"click .pubHeader":function(e){},"contextmenu .cell":function(t){if(this.options.xmenu){var i=e(t.currentTarget);return i.hasClass("catalog-value")?(i.trigger("contextmenuCatalog",{pageY:t.pageY,pageX:t.pageX}),!1):(i.hasClass("selected")||this._clickCell(i),this._showContextmenu(t,i),!1)}},"contextmenuAction .cell":function(e,t){t.name&&this.execCommand(e.currentTarget,{name:"xmenu_"+t.name,event:e})}})},_selectedRow:function(t){this._clearSelectedArea(),e(this.tableDom).find("tr:eq("+t+") td").addClass("selected"),this._selectAreaChanged()},_selectedCol:function(t){this._clearSelectedArea(),e(this.tableDom).find("tr").find("td:eq("+t+")").addClass("selected"),this._selectAreaChanged()},_clickCell:function(e){this._clearSelectedArea(),this.element.find(".cell.cell-click").not(e).removeClass("cell-click"),e.addClass("cell-click").addClass("selected"),this._selectAreaChanged()},_addAreaSytle:function(e,t){this._cellIter(e,function(e){e.addClass(t)}),this._selectAreaChanged()},_selectAreaChanged:function(){this._trigger("areaChange",{})},_openEditor:function(t){if(t.hasClass("cell-editing")||t.hasClass("conditional-item"))t.hasClass("fieldSelect")&&this._closeEditor();else{this._closeEditor();var i=t.data("value")||t.text();t.addClass("cell-editing").data("oldValue",i);var r=t.data("editor")||t.attr("data-editor")||"fieldText";if("fieldText"==r)t.hasClass("catalog-value")?e('<input style="width:100%;" class="editor fieldText" data-value="'+t.data("value")+'" value="'+t.text()+'"/>').appendTo(t.empty()).focus():e('<input style="width:100%;" class="editor fieldText" value="'+e.trim(i)+'"/>').appendTo(t.empty()).focus();else if("fieldRadioGroup"==r)e(function(e,t,i){var r=[];if(i&&t&&i[t])for(var n in i[t])r.push('<span class="option-item radio-item youi-icon icon-circle-blank" data-value="'+n+'">'+(i[t][n]||"")+"</span>");return r.join("")}(0,t.data("convert"),this.options.converts)).appendTo(t.empty()).focus();else if("fieldSelect"==r){t.addClass("open");var s=e(".editor.select-value:first",t),o={value:s.data("value"),text:s.text()};t.parent().prevAll().length>11?t.addClass("dropup"):t.addClass("dropdown"),e(function(t,i,r){var s=[];if(s.push('<span class="editor select-value" data-value="'+t.value+'" data-toggle="dropdown" aria-expanded="true">'+(t.text||"")+"</span>"),s.push('<ul class="dropdown-menu">'),s.push('<li class="option-item" data-value="">请选择</li>'),r&&i&&r[i]){var o=[];e.each(r[i],function(e,t){o[o.length]=e}),o.sort(n),e.each(o,function(e,t){s.push('<li class="option-item" data-value="'+t+'">'+t+" "+(r[i][t]||"")+"</li>")})}return s.push("</ul>"),s.join("")}(o,t.data("convert"),this.options.converts)).appendTo(t.empty()).focus()}else if("fieldAutocomplete"==r&&this.options.searchUrl){var a={id:t.data("editorId"),key:t.data("editorKey")},l=t.text(),d=e.youi.recordUtils.replaceByRecord(this.options.searchUrl,a),h=(this.options.searchValueAttr,this.options.searchTextAttr||"text"),c={url:d,notShowLoading:!0,success:function(t){var i=[];e(t.records).each(function(){i.push(e.extend({value:this[h],label:this[h]},this))}),this.response(i)}};e('<input style="width:100%;" class="editor select-value fieldAutocomplete" data-value="'+i+'" value="'+i+'"/>').appendTo(t.empty()).autocomplete({position:{my:"right bottom",at:"right top"},source:function(t,i){this.xhr&&this.xhr.abort(),this.xhr=e.youi.ajaxUtils.ajax(e.extend({data:t,response:i},c))},select:this._proxy("_itemValueSelect",t),close:this._proxy("_closeEditorBySelect",e.extend({},{cellElem:t,oldText:l}))})}}},_itemValueSelect:function(t,i,r){e(t.target).attr("data-value",i.item.value),i.cellElem=r,this._trigger("itemValueSelect",t,i)},_closeEditorBySelect:function(t,i,r){var n=e(t.target);e(r.cellElem).data("oldText",r.oldText),n.data("value")||n.val(""),this._closeEditor()},_closeEditor:function(){var t=e(".cell.cell-editing",this.tableDom),i=t.data("oldText")||"",n=e("input.editor",t),s=n.val()||"";if(t.length){if(t.find(".dropdown-menu").length)return void t.removeClass("cell-editing").removeClass("open");if("fieldAutocomplete"===t.data("editor")&&i&&(s=i),n.hasClass("select-value")&&"fieldAutocomplete"!==t.data("editor")&&(s=n.data("value")||""),t.removeClass("cell-editing").empty().text(s),s!==i){var o=e.extend({rowIndex:t.parent().prevAll().length,colIndex:t.prevAll().length},r(t));this._trigger("cellTextChange",null,{record:o,oldText:i})}}},_showContextmenu:function(t,i){var r=e("#"+this.options.xmenu);if(r.length){r.hasClass("hidden")&&r.removeClass("hidden");var n=r.parents(".page-container:first").offset(),s=i[0].className.split(" ");this.element.find(".cell.selected").length>1&&s.push("area"),r.trigger("open",{bind:i[0],left:t.pageX+10-n.left,top:t.pageY+10-n.top,groups:s})}},_hiddenContextMenu:function(){e("#"+this.options.xmenu).hide()},loadDatas:function(e,t,i){var r=['<table class="table">'];r.push(this._buildColHeaders(i)),r.push(this._buildBody(e,t,i)),r.push("</table>"),this.element.find("table").remove(),this.element.append(r.join("")),this.tableDom=this.element.find("table")[0]},fillRecords:function(t){if(e.isArray(t))for(var i=0;i<t.length;i++){var r=t[i];this._fillCellByRecord(r)}},_fillCellByRecord:function(t){if(t&&t.rowIndex>-1&&t.colIndex>-1){var r=e(this.tableDom.rows[t.rowIndex].cells[t.colIndex]),n=i(t);r.after(e(n)).remove()}},getActiveGroups:function(){var e=[],t=this.element.find(".selected").length;return t&&e.push("cell"),(this.element.find(".selected.merged-cell").length>0||t>1)&&e.push("merge"),e},loadXml:function(t){var i=['<table class="table">'];i.push(t),i.push("</table>"),this.element.find("table").remove(),this.element.append(i.join("")),this.tableDom=this.element.find("table")[0];var r=e("tbody",this.tableDom).data("colwidths").split(",");e(this.tableDom).prepend("</thead>"+this._buildColHeaders(r.length,r)+"</thead>"),e("tbody>tr",this.tableDom).each(function(t){e(this).prepend('<td class="rowHeader">'+(t+1)+"</td>")})},loadSheetHtml:function(e){this.element.html(e),this.tableDom=this.element.find("table")[0]},getSelectedArea:function(e,t){return this._selectedAreaIter()},getCellRecord:function(t){return e.extend({rowIndex:t.parent().prevAll().length,colIndex:t.prevAll().length},r(t))},processCellRecord:function(t,i){var r=e(this.tableDom.rows[t.rowIndex+1].cells[t.colIndex]);e.isFunction(i)&&i(t,r)},processArea:function(e,t){return this._cellAreaRecordsIter(e,t)},setCellText:function(t){e(this.tableDom.rows[t.rowIndex+1].cells[t.colIndex]).text(t.text)},insertRow:function(t,r){var n=this.tableDom.rows[0].cells.length-1,s=[""],o=(r=r||[],[]),a={},l=null;t.startRow+1<this.tableDom.rows.length-1&&(l=e(this.tableDom.rows[t.startRow+1]),e("td",l).each(function(i){var r=e(this).attr("data-merge-id");if(o[i]=r,r&&!a[r]){var n=e(".cell#"+r,this.parentNode.parentNode),s=parseInt(n.attr("rowspan"));n.attr("rowspan",s+t.rows),a[r]=r}}));for(var d=0;d<t.rows;d++){s.push('<tr class="rowTr"><td class="rowHeader"></td>');for(var h=0;h<n;h++){var c=e.extend({text:"",class:"cell",datas:{}},r[h]);o[h]&&(c.class="cell hide",c.datas.mergeId=o[h]),s.push(i(c))}s.push("</tr>")}return l?l.before(e(s.join(""))):e("tbody",this.tableDom).append(s.join("")),this._reBuildRowHeader(),t},appendRow:function(){var t=this.tableDom.rows[0].cells.length-1,r=[];r.push('<tr class="rowTr"><td class="rowHeader"></td>');for(var n=0;n<t;n++)r.push(i({class:"cell"}));r.push("</tr>"),e("tbody",this.tableDom).append(r.join("")),this._reBuildRowHeader()},reBuildRowHeader:function(){this._reBuildRowHeader()},insertRowHtmls:function(t,i){t.startRow+1<this.tableDom.rows.length-1?e(this.tableDom.rows[t.startRow+1]).before(e(i)):e("tbody",this.tableDom).append(e(i)),e("[data-old-rowspan]",this.tableDom).each(function(){var t=e(this),i=parseInt(t.attr("data-old-rowspan")),r=t.attr("data-merge-id");t.removeAttr("data-old-rowspan"),e("#"+r,t.parents("tbody:first")).attr("rowspan",i)}),this._reBuildRowHeader()},deleteRow:function(t){for(var i=e("<table></table>"),r=0;r<t.rows;r++)e(this.tableDom.rows[t.startRow+1]).appendTo(i);this._reBuildRowHeader();var n={};for(var s in i.find("[data-merge-id]").each(function(){var t=e(this).attr("data-merge-id");t&&!n[t]&&(n[t]=t)}),n){var o=e("#"+s,this.tableDom),a=parseInt(o.attr("rowspan")),l=o.parent().prevAll().length+a-1,d=0;t.endRow>l&&(d=t.endRow-l),o.attr("rowspan",a-t.rows+d),i.find("[data-merge-id="+s+"]:first").attr("data-old-rowspan",a)}var h=i.find("tbody").html();return i.remove(),h},insertCol:function(t,r){for(var n=this.tableDom.rows.length,s=t.startCol,o=(r=r||[],{}),a=0;a<n;a++){var l=[],d=e(this.tableDom.rows[a].cells[s]),h=d.attr("data-merge-id");if(d&&h){var c=o[h]||e("#"+h,this.tableDom);if(c.prevAll().length<=s){if(!o[h]){var u=parseInt(c.attr("colspan"));c.attr("colspan",u+t.cols)}}else h="";o[h]=c}for(var p=0;p<t.cols;p++)if(0===a)l.push('<th class="colHeader" style="width:100px;"></th>');else{var f=e.extend({text:"",class:"cell",datas:{}},r[a]);h&&(f.class="cell hide",f.datas.mergeId=h),l.push(i(f))}d.before(l.join(""))}return this._reBuildColHeader(),t},appendCol:function(){e("thead>tr",this.tableDom).append('<th class="colHeader"></th>'),e("tr.rowTr",this.tableDom).each(function(){e(this).append(i({class:"cell"}))}),this._reBuildColHeader()},appendBlankCol:function(){e(this.tableDom).addClass("tableNoBorder"),e("thead>tr",this.tableDom).append('<th class="blankHead"></th>'),e("tr.rowTr",this.tableDom).each(function(){e(this).append(i({class:"cell hide"}))}),this._reBuildColHeader()},deleteCol:function(t){for(var i=this.tableDom.rows.length,r={},n=[],s=t.startCol,o=0;o<i;o++){for(var a=e("<tr></tr>"),l=0;l<t.cols;l++){var d=e(this.tableDom.rows[o].cells[s]),h=d.attr("data-merge-id");if(h&&!r[h]){var c=e("#"+h,this.tableDom),u=parseInt(c.attr("colspan")),p=c.prevAll().length+u-1,f=0;t.endCol>p&&(f=t.endCol-p),c.attr("colspan",u-t.cols+f),d.attr("data-old-colspan",u),r[h]=h}a.append(d)}n.push(a.html()),a.remove()}return this._reBuildColHeader(),n},insertColHtmls:function(t,i){for(var r=this.tableDom.rows.length,n=t.startCol,s=this.tableDom.rows[0].cells.length===n,o=0;o<r;o++)s?e(this.tableDom.rows[o]).append(i[o]):e(this.tableDom.rows[o].cells[n]).before(i[o]),e("[data-old-colspan]",this.tableDom).each(function(){var t=e(this),i=parseInt(t.attr("data-old-colspan")),r=t.attr("data-merge-id");t.removeAttr("data-old-colspan"),e("#"+r,t.parents("tbody:first")).attr("colspan",i)});this._reBuildColHeader()},clearArea:function(t,i,r){return this._cellAreaRecordsIter(r,function(t,i,r,n){i.before(e('<td class="cell selected"></td>')).remove()})},clearAreaText:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,t,i,r){t.text("")})},mergeArea:function(t,i,r){var n,s=!1,o=this._cellAreaRecordsIter(r,function(e,t,i,r){(t.hasClass("merged-cell")||t.is("[data-merge-id]"))&&(s=!0)});s?this._cellAreaRecordsIter(r,function(t,i,r,n){if(i.hasClass("merged-cell")){var s=i.attr("id");i.removeClass("merged-cell").removeAttr("id").removeAttr("rowspan").removeAttr("colspan"),e("[data-merge-id="+s+"]",i.parent().parent()).removeClass("hide").removeAttr("data-merge-id")}}):this._cellAreaRecordsIter(r,function(e,t,i,s){r.startRow===i-1&&r.startCol===s?(n="m_"+i+"_"+s+"_"+(new Date).getTime(),t.attr("id",n).addClass("merged-cell").attr("rowspan",r.rows).attr("colspan",r.cols).css("textAlign","center")):t.addClass("hide").attr("data-merge-id",n)});return o},setTextIndent:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,i,r,n){i.css("textIndent",t.value)})},setAlign:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,i,r,n){i.css("textAlign",t.value)})},setColor:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,i,r,n){i.css("color",t.value)})},setBgColor:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,i,r,n){i.css("backgroundColor",t.value)})},setFontSize:function(e,t,i){return this._cellAreaRecordsIter(i,function(e,i,r,n){i.css("fontSize",t.value)})},setSequence:function(e,t,i){var r=0;return this._cellAreaRecordsIter(i,function(e,t,i,n){t.text(++r)})},setBorder:function(t,i,r){var n=e.extend({},r,{startRow:r.startRow>0?r.startRow-1:r.startRow,startCol:r.startCol>1?r.startCol-1:r.startCol});if(n.cols=n.endCol-n.startCol+1,n.rows=n.endRow-n.startRow+1,"outerBorder"===i.value)return this._setOuterBorder(r,n);var s=i.value.split(",");return this._cellAreaRecordsIter(n,function(e,t,o,a){if(o!==r.startRow||a!==r.startCol-1)if(o===r.startRow)"1"===s[0]?t.css("borderBottomColor","black"):"0,0,0,0"==i.value&&t.css("borderBottomColor","");else if(a===r.startCol-1&&o>r.startRow)"1"==s[3]?t.css("borderRightColor","black"):"0,0,0,0"==i.value&&t.css("borderRightColor","");else if(o>r.startRow-1&&a>r.startCol-1){var l={borderRightColor:"",borderBottomColor:""};"1"===s[0]&&n.startRow!=o&&"1,0,0,0"==i.value&&r.endRow>=o&&(l.borderBottomColor="black"),"1"===s[1]&&(l.borderRightColor="black"),"1"===s[2]&&(l.borderBottomColor="black"),"1"===s[3]&&n.startCol!=a&&"0,0,0,1"==i.value&&r.endCol>a&&(l.borderRightColor="black"),t.css(l)}})},_setOuterBorder:function(e,t){return this._cellAreaRecordsIter(t,function(i,r,n,s){s>e.startCol-1&&(n===e.startRow||n===e.endRow+1)&&r.css("borderBottomColor","black"),n>e.startRow&&(s===t.startCol&&e.startCol!=t.startCol||s===t.endCol)&&r.css("borderRightColor","black")})},_selectedAreaIter:function(t){var i=e(".selected.cell:first",this.tableDom),r=e(".selected.cell:last",this.tableDom);return this._cellAreaIter(i,r,t)},buildXml:function(t){var n=[],s=[];for(var o in this.element.find("thead .colHeader").not(".pubHeader").each(function(){s.push(e(this).outerWidth())}),t=e.extend({},t,{colWidths:s.join()}),n.push("<tbody "),t)t[o]&&n.push("data-"+o+'="'+t[o]+'" ');return n.push(">"),this.element.find(".rowTr").each(function(){var t=[];e(this).find(".cell").each(function(){t.push(i(r(e(this))))}),t.length&&(n.push('<tr class="rowTr">'),(n=n.concat(t)).push("</tr>"))}),n.push("</tbody>"),n.join("")},_isEmptyRow:function(t){return!e(t.text())},_buildColHeaders:function(e,i){var r=[];i=i||[];r.push('<thead><tr><th style="width:25px;" class="pubHeader">&nbsp;</th>');for(var n=0;n<e;n++)r.push('<th class="colHeader" style="width:'+(i[n]||100)+'px">'+t(n+1)+' <span class="col-resize-handler pull-right"></span></th>');return r.push("</tr></thead>"),r.join("")},_buildBody:function(e,t,i){for(var r=["<tbody>"],n=0;n<t;n++){r.push('<tr class="rowTr"><td class="rowHeader">'+(n+1)+"</td>");for(var s=0;s<i;s++)r.push('<td class="cell"></td>');r.push("</tr>")}return r.push("</tbody>"),r.join("")},rebuildTable:function(){var t=0;this.element.find("table").find("tr").each(function(){var i=e(this)[0].cells.length;i>t&&(t=i)});var i=this._buildCell("");this.element.find("table").find("tr").each(function(){for(var r=e(this)[0].cells.length,n=t-r,s=r-1;n>0;)e(this).find("th:eq("+s+")").each(function(){e(this).after('<th class="colHeader"></th>')}),e(this).find("td:eq("+s+")").each(function(){e(this).after(i)}),n-=1}),this.removeLastEmptyCol(),this._reBuildRowHeader(),this._reBuildColHeader()},_removeLastEmptyRow:function(){for(var t=this.getLastEmptyRowIndex(),i=this.element.find("table")[0].rows.length;i>t;)this.element.find("table").find("tr:eq("+i+")").each(function(){e(this).remove()}),i-=1},removeLastEmptyCol:function(){for(var t=this.getLastEmptyColIndex(),i=this.element.find("table").find(".rowHeader").length;t<i;)i-=1,this.element.find("table").find("tr").find("th:eq("+i+")").each(function(){e(this).remove()}),this.element.find("table").find("tr").find("td:eq("+i+")").each(function(){e(this).remove()})},getLastEmptyRowIndex:function(){var t=1,i=1;return this.element.find(".rowTr").each(function(){var r=!1;e(this).find(".cell").each(function(){e(this).data("group")&&(r=!0),e(this).data("expression")&&(r=!0),e(this).text()&&(r=!0)}),r&&(i=t),t+=1}),i},getLastEmptyColIndex:function(){var t=1;return this.element.find(".rowTr").each(function(){var i=!1,r=1;e(this).find(".cell").each(function(){e(this).data("group")&&(i=!0),e(this).data("expression")&&(i=!0),e(this).text()&&(i=!0),i&&(r=e(this)[0].cellIndex+1)}),t<r&&(t=r)}),t},_reBuildRowHeader:function(){this.element.find("table").find(".rowHeader").each(function(t){e(this).text(t+1)})},_reBuildColHeader:function(){this.element.find("table").find(".colHeader").not(".pubHeader").each(function(i){e(this).html(t(i+1)+'<span class="col-resize-handler pull-right"></span>')})},_destroy:function(){this.tableDom=null,this.pasteHelper&&this.pasteHelper.remove(),this.pasteHelper=null},setEditable:function(e){this.options.editable=e},getEditable:function(){return this.options.editable},xmenu_paste:function(e,t){this.pasteHelper.trigger("paste")},_resize:function(){}}))}(jQuery)},function(e,t){!function(e){"use strict";function t(t,i,r){var n=[],s=t+"_"+i.name;return n.push('<div class="panel panel-default">'),n.push('<div class="panel-heading" role="tab" id="'+s+'_head">'),n.push('    <span class="panel-title">'),n.push('   <a role="button" data-toggle="collapse" data-parent="#accordion" href="#'+s+'" aria-expanded="'+r+'" aria-controls="'+s+'">'),n.push(i.text),n.push(" </a>"),n.push(" </span>"),n.push(" </div>"),n.push('<div id="'+s+'" class="panel-collapse collapse '+(r?" in":"")+'" role="tabpanel" aria-labelledby="'+s+'_head">'),n.push('    <div class="panel-body" data-id="'+i.name+'">'),e(i.items).each(function(){var e;n.push('<div class="expression-item col-sm-'+((e=this).column||6)+" "+e.id+'" data-expression="'+e.expression+'">'+(e.text||e.id)+"</div>")}),n.push("</div></div>"),n.push("</div>"),n.join("")}function i(t,i){return'<input type="button" '+function(t,i){var r=[];for(var n in i=i||[],t){var s=e.youi.stringUtils.convertDataProperty(n,"-");-1!=e.inArray(s,i)&&r.push("data-"+s+'="'+(t[n]||"")+'"')}return r.join(" ")}(t,i)+' class="keyword" value="'+t.text+'" title="'+t.text+'"/>'}e.widget("youi.expressionEditor",e.youi.abstractWidget,e.extend({},{options:{bindResize:!0,rootText:"项",itemCaption:"项",keyTreeUrl:"",treeNodeGroups:"",itemProps:"id,text",expressionItems:{operator:{text:"操作符",items:[{id:"add",text:"加",expression:"+"},{id:"subtract",text:"减",expression:"-"},{id:"multiply",text:"乘",expression:"*"},{id:"divide",text:"除",expression:"/"},{id:"pow",text:"平方",expression:"^"},{id:"mod",text:"求余",expression:"%"},{id:"lbrackets",text:"左括号",expression:"("},{id:"rbrackets",text:"右括号",expression:")"},{id:"sum",text:"求和",expression:"∑"}]},func:{text:"常用函数",items:[{id:"max",text:"最大值",expression:"max({0},{1})"},{id:"min",text:"最小值",expression:"min({0},{1})"},{id:"avg",text:"平均值",expression:"avg({0},{1})"},{id:"yearOnYear",text:"上年同期",expression:"yearOnYear({0})"},{id:"monthOnMonth",text:"上期值",expression:"monthOnMonth({0})"}]}}},_initWidget:function(){this.element.addClass("youi-field auto-height").attr("data-field-type",this.widgetName).attr("data-property",this.options.name),this.contentElem=this.element.find("."+this.widgetName+"-content:first"),"string"==typeof this.options.treeNodeGroups&&(this.options.treeNodeGroups=this.options.treeNodeGroups.split(",")),"string"==typeof this.options.itemProps&&(this.options.itemProps=this.options.itemProps.split(",")),this._initContentHtml()},_initContentHtml:function(){var e=[],i=this.element.attr("id"),r=i+"e";e.push('<div class="col-sm-3 panel-group no-padding" id="accordion" role="tablist" aria-multiselectable="true">'),e.push(t(i,{name:"indicators",text:this.options.itemCaption},!0)),e.push("</div>"),e.push('<div class="col-sm-9"><div id="'+r+'" class="expression-editor" style="height:100px;"></div></div>'),this.contentElem.html(e.join("")),this.itemContainer=this.contentElem.find(".panel-body[data-id=indicators]"),UE.delEditor(r),this.ueditor=UE.getEditor(r,{toolbars:[["undo","redo"]],initialFrameHeight:345,autoHeightEnabled:!0,autoFloatEnabled:!0,elementPathEnabled:!1}),this.options.keyTreeUrl&&this._initKeyTree()},_initKeyTree:function(){var t=this.element.attr("id")+"tree",i=["<ul>"];i.push(e.youi.treeUtils.treeNodeHtml("ROOT",this.options.rootText,{group:"root",src:this.options.keyTreeUrl})),i.push("</ul>"),this.keyTreeElem=this.itemContainer.attr("id",t).html(i.join("")).tree({xmenu:this.options.refs[0],dragable:!0,hideRoot:!0,check:"true"==this.options.check}),window[t+"_xmenu_addItem"]=this._proxy("_addItem")},_addItem:function(t,i){var r=this.keyTreeElem.tree("getSelected");if(i.value&&r.length){var n="_"+("yearOnYear"==i.value?"上年同期":"上期"),s=r.data(),o=e.extend({id:r.attr("id"),mappedId:s.reportCode+s.physicalTableNum},s,{text:e.youi.treeUtils.getNodeText(r)+n,expression:i.value});this._insertKeyItem(o)}},_initAction:function(){this._on({"dblclick .expressionEditor-content .expression-item":function(t,i){var r=e(t.currentTarget).data();this.ueditor.ready(function(){this.execCommand("inserthtml",r.expression)})},"dblclick .expressionEditor-content .option-item":function(t,i){var r=e(t.currentTarget),n=r.data(),s=e.extend({id:n.value,mappedId:""},n,{text:r.text()});this._insertKeyItem(s)},"dblclick .expressionEditor-content .treeNode":function(t,i){var r=e(t.currentTarget),n=r.data(),s=n.group;if(-1!=e.inArray(s,this.options.treeNodeGroups)){var o=e.extend({id:r.attr("id")},n,{text:e.youi.treeUtils.getNodeText(r)});this._insertKeyItem(o)}return!1}})},_insertKeyItem:function(e){var t=i(e,this.options.itemProps),r=this.ueditor;this.ueditor.ready(function(){r.execCommand("inserthtml",t)})},parseExpressionItems:function(i){var r=function(i,r){var n=[];for(var s in r)n.push(t(i,e.extend({},r[s],{name:s})));return n.join("")}(this.element.attr("id"),i);this.element.find(".panel-group:first").append(r)},parseItems:function(t){var i=[];t&&e(t.records).each(function(){i.push('<span data-id="'+this.id+'" class="option-item" data-expression="'+(this.expression||"")+'" data-value="'+this.id+'">'+this.text+"</span>")}),this.itemContainer.html(i.join(""))},getValue:function(){var t,i=this.ueditor.getContent(),r=[],n=e(i).appendTo(this.element);return n.find("input.keyword").each(function(t){var i=e(this);r.push(e.extend({text:i.val()},i.data())),e("<span>{"+t+"}</span>").insertBefore(i),i.remove()}),t=n.text(),n.remove(),{items:r,source:t}},setValue:function(t){if(t){var r=[],n=this.options.itemProps;e(t.items).each(function(){r.push(i(this,n))})}var s=e.youi.getMessage(t.source,r)||"";this.ueditor.ready(function(){s&&this.setContent(s)})},clear:function(){},validate:function(e){this.element.removeClass("validate-success").removeClass("validate-error").removeAttr("title");var t=[];t.length?this.element.removeClass("validate-success").addClass("validate-error").attr("title",t.join("")):this.element.removeClass("validate-error").addClass("validate-success")},_resize:function(){},_destroy:function(){this.ueditor=null}}))}(jQuery)},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){}]);